

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Part 2: BW4T action plan &mdash; MATRXS 0.0.1 Manual 0.0.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Examples" href="examples.html" />
    <link rel="prev" title="Part 1: BW4T skeleton" href="bw4t_part1.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> MATRXS 0.0.1 Manual
          

          
            
            <img src="../_static/matrx_logo.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting started</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../general_info/aboutmatrxs.html">About MATRXS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation/installing.html">Installation and first run</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="tutorials.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="create_world.html">Creating your MATRXS world</a></li>
<li class="toctree-l2"><a class="reference internal" href="adding_objects.html">Adding objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="agent_implementation.html">Implementing an agent</a></li>
<li class="toctree-l2"><a class="reference internal" href="bw4t_part1.html">Part 1: BW4T skeleton</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Part 2: BW4T action plan</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_by_category.html">Reference by category</a></li>
</ul>
<p class="caption"><span class="caption-text">General Information</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../general_info/when_to_use.html">When to use</a></li>
<li class="toctree-l1"><a class="reference internal" href="../general_info/glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../general_info/roadmap.html">Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../general_info/faq.html">F.A.Q.</a></li>
</ul>
<p class="caption"><span class="caption-text">For Developers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../developer_info/how_to_contribute.html">How to contribute</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer_info/changelog.html">Changelog</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference by Category</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../sections/worlds.html">Worlds</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sections/actions.html">Actions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sections/agents.html">Agents</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sections/objects.html">Object placement</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sections/simgoals.html">Simulation goals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sections/scenarios.html">Scenarios</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sections/utils.html">Utils</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">MATRXS 0.0.1 Manual</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="tutorials.html">Tutorials</a> &raquo;</li>
        
      <li>Part 2: BW4T action plan</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/tutorials/bw4t_part2.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="part-2-bw4t-action-plan">
<h1>Part 2: BW4T action plan<a class="headerlink" href="#part-2-bw4t-action-plan" title="Permalink to this headline">¶</a></h1>
<p>In deciding what action to perform, the agent loops through a list of actions that are needed to complete the task.
During the execution of these actions, the agent also keeps track of what other agents might be doing, so that the same
task will not be executed twice. Most actions need corresponding objects in the grid world in order to correctly be
executed. In the code block below, an example is given of how to save the objects for later use.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">decide_on_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>

   <span class="c1"># Determine current goal for this agent</span>
   <span class="k">global</span> <span class="n">cycle</span>
   <span class="bp">self</span><span class="o">.</span><span class="n">current_goal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">goal_cycle</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

   <span class="c1"># Determine which block color is needed</span>
   <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block_orders</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
       <span class="n">current_order</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_orders</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
   <span class="k">else</span><span class="p">:</span>
       <span class="k">return</span> <span class="n">StandStill</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="p">{}</span>

   <span class="c1"># Gather the id of this agent and the other</span>
   <span class="n">this_agent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent_id</span>
   <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">state</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
       <span class="k">if</span> <span class="s1">&#39;Bot&#39;</span> <span class="ow">in</span> <span class="n">k</span> <span class="ow">and</span> <span class="n">this_agent</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">k</span><span class="p">:</span>
           <span class="n">other_agent</span> <span class="o">=</span> <span class="n">k</span>

   <span class="c1"># From all objects, gather the objects that are doors and save them. This approach can be taken for every</span>
   <span class="c1"># object that is not a door, too!</span>
   <span class="n">objects</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
   <span class="n">doors</span> <span class="o">=</span> <span class="p">[</span><span class="n">obj</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">objects</span>
            <span class="k">if</span> <span class="s1">&#39;class_inheritance&#39;</span> <span class="ow">in</span> <span class="n">state</span><span class="p">[</span><span class="n">obj</span><span class="p">]</span> <span class="ow">and</span> <span class="n">state</span><span class="p">[</span><span class="n">obj</span><span class="p">][</span><span class="s1">&#39;class_inheritance&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Door&quot;</span><span class="p">]</span>
   <span class="n">door_locations</span> <span class="o">=</span> <span class="p">[]</span>
   <span class="n">door_ids</span> <span class="o">=</span> <span class="p">[]</span>
   <span class="k">for</span> <span class="n">door</span> <span class="ow">in</span> <span class="n">doors</span><span class="p">:</span>
       <span class="n">door_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">door</span><span class="p">)</span>
       <span class="n">door_location</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="n">door</span><span class="p">][</span><span class="s1">&#39;location&#39;</span><span class="p">]</span>
       <span class="n">door_locations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">door_location</span><span class="p">)</span>

   <span class="k">return</span> <span class="n">StandStill</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="p">{}</span>
</pre></div>
</div>
<p>For every action an agent should perform, a separate case in the action decision plan needs to be defined. The implementation
of the first action, finding the correct room, is explained below. It should be added to ‘decide_on_action’ that is
described above. The other actions follow similar steps. They can be added according to your liking.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># First, check if the other agent(s) have sent messages. (See GitHub for method implementation)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">check_for_update</span><span class="p">(</span><span class="n">current_order</span><span class="p">)</span>

<span class="c1"># Navigate to a room</span>
<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_goal</span> <span class="o">==</span> <span class="s2">&quot;find_room&quot;</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">navigator</span><span class="o">.</span><span class="n">reset_full</span><span class="p">()</span>
    <span class="c1"># Setting location that is in front of a door</span>
    <span class="k">for</span> <span class="n">doormat</span> <span class="ow">in</span> <span class="n">doormats</span><span class="p">:</span>
        <span class="n">doormat_id</span> <span class="o">=</span> <span class="n">doormats</span><span class="p">[</span><span class="n">doormat</span><span class="p">][</span><span class="s1">&#39;doormat_id&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">current_order</span> <span class="ow">in</span> <span class="n">doormat_id</span><span class="p">:</span>
            <span class="n">doormat_waypoint</span> <span class="o">=</span> <span class="n">doormats</span><span class="p">[</span><span class="n">doormat</span><span class="p">][</span><span class="s1">&#39;location&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">navigator</span><span class="o">.</span><span class="n">add_waypoint</span><span class="p">(</span><span class="n">doormat_waypoint</span><span class="p">)</span>
            <span class="n">move_action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">navigator</span><span class="o">.</span><span class="n">get_move_action</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state_tracker</span><span class="p">)</span>

            <span class="n">current_waypoint</span> <span class="o">=</span> <span class="n">doormat_waypoint</span>
            <span class="c1"># Update other agent(s) that this order is already executed</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent_properties</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">current_waypoint</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">message_content</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">doormat_id</span><span class="p">},</span>
                                  <span class="n">to_id</span><span class="o">=</span><span class="n">other_agent</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">goal_cycle</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Return the action from the Navigator</span>
    <span class="k">return</span> <span class="n">move_action</span><span class="p">,</span> <span class="p">{}</span>
</pre></div>
</div>
<p>For the full code example, including the other action states, see the MATRXS GitHub page.</p>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="examples.html" class="btn btn-neutral float-right" title="Examples" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="bw4t_part1.html" class="btn btn-neutral float-left" title="Part 1: BW4T skeleton" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, The MATRXS Team at TNO.nl

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    

  <style>
    /* Sidebar header (and topbar for mobile) */
    .wy-side-nav-search, .wy-nav-top {
      background: #303030;
    }
    /* Sidebar */
    .wy-nav-side {
      background: #578a64;
    }
  </style>


</body>
</html>